@model IEnumerable<CRUDoperation.Models.EmployeeModel>
@* @model CRUDoperation.Models.EmployeeModel; *@

@{
    ViewData["Title"] = "Employee Details";
   }
    <h2>@ViewData["Title"]</h2>

    <p>
         @* <a asp-action="Create" class="btn btn-primary btn-sm">ADD</a> *@
    <button type="button"  class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal">
        ADD
    </button>
    
    </p>
<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">

    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Add Details</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <div class="modal-body">

                @* <form asp-action="create" enctype="multipart/form-data"> *@

                    <div class="mb-3">
                        <label for="firstName" class="form-label">First Name : </label>
                        <input id="firstName" type="text" name="firstName" class="form-control" />
                    </div>
                     
                    <div class="mb-3">
                        <label for="lastName" class="form-label">Last Name : </label>
                        <input id="lastName" type="text" name="lastName" class="form-control" />
                    </div>

                    <div class="mb-3">
                        <label for="contactNumber" class="form-label">Contact Number : </label>
                        <input id="contactNumber" type="tel" name="contactNo" class="form-control" />
                    </div>

                    <div class="mb-3">
                        <label for="emailId" class="form-label">Email Id : </label>
                        <input id="emailId" type="email" name="emailId" class="form-control" />
                    </div>

                    <div class="mb-3">
                        <label for="age" class="form-label">Age : </label>
                        <input id="age" type="number" name="age" class="form-control" />
                    </div>

                    <div class="mb-3">
                        <label for="imageFile" class="form-label">Image : </label>
                        <input id="imageFile" name="imageFile" id="imageFile" type="file" class="form-control">
                    </div>

                    @* <button type="submit" id="btns" class="btn btn-outline-primary mb-3">Submit</button> *@
                @* </form> *@
            </div>
            <div class="modal-footer">
                <button type="button"  class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" onclick="AddEmployee()" class="btn btn-primary">Save changes</button>
            </div>

        </div>
    </div>
</div>

<div class="modal fade" id="updateModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">

    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Edit Details</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <div class="modal-body">
                <input hidden id="updateemp_id" />
                @* <form asp-action="create" enctype="multipart/form-data"> *@

                <div class="mb-3">
                    <label for="firstName" class="form-label">First Name : </label>
                    <input id="updatedFirstName" type="text" name="firstName" class="form-control" />
                </div>

                <div class="mb-3">
                    <label for="lastName" class="form-label">Last Name : </label>
                    <input id="updatedlastName" type="text" name="lastName" class="form-control" />
                </div>

                <div class="mb-3">
                    <label for="contactNumber" class="form-label">Contact Number : </label>
                    <input id="updatedcontactNumber" type="tel" name="contactNo" class="form-control" />
                </div>

                <div class="mb-3">
                    <label for="emailId" class="form-label">Email Id : </label>
                    <input id="updatedemailId" type="email" name="emailId" class="form-control" />
                </div>

                <div class="mb-3">
                    <label for="age" class="form-label">Age : </label>
                    <input id="updatedage" type="number" name="age" class="form-control" />
                </div>

                <div class="mb-3">
                    <label for="imageFile" class="form-label">Image : </label>
                    <input id="updatedimageFile" name="imageFile" id="imageFile" type="file" class="form-control">
                </div>

                @* <button type="submit" id="btns" class="btn btn-outline-primary mb-3">Submit</button> *@
                @* </form> *@
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" onclick="updateEmployee()" class="btn btn-primary">Save changes</button>
            </div>

        </div>
    </div>
</div>


<div class="modal fade" id="viewModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">

    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">View Details</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <div class="modal-body">
                <label for="EmployeeID" class="form-label">EmployeeID : </label>
                <input id="viewemp_id" type="text" name="EmployeeID" class="form-control" />
                @* <form asp-action="create" enctype="multipart/form-data"> *@

                <div class="mb-3">
                    <label for="firstName" class="form-label">First Name : </label>
                    <input id="viewFirstName" type="text" name="firstName" class="form-control" />
                </div>

                <div class="mb-3">
                    <label for="lastName" class="form-label">Last Name : </label>
                    <input id="viewlastName" type="text" name="lastName" class="form-control" />
                </div>

                <div class="mb-3">
                    <label for="contactNumber" class="form-label">Contact Number : </label>
                    <input id="viewcontactNumber" type="tel" name="contactNo" class="form-control" />
                </div>

                <div class="mb-3">
                    <label for="emailId" class="form-label">Email Id : </label>
                    <input id="viewemailId" type="email" name="emailId" class="form-control" />
                </div>

                <div class="mb-3">
                    <label for="age" class="form-label">Age : </label>
                    <input id="viewage" type="number" name="age" class="form-control" />
                </div>

                <div class="mb-3">
                    <label for="imageFile" class="form-label">Image : </label>
                    <input id="viewimageFile" name="imageFile" id="imageFile" type="file" class="form-control">
                </div>

                @* <button type="submit" id="btns" class="btn btn-outline-primary mb-3">Submit</button> *@
                @* </form> *@
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                @* <button type="button" onclick="updateEmployee()" class="btn btn-primary">Save changes</button> *@
            </div>

        </div>
    </div>
</div>
<table class="table" id="myTable" style="width:100% !important">
        <thead>
            <tr>
               @*  <th>#</th> *@
                <th>emp_id</th>
                <th>first_name</th>
                <th>last_name</th>
                <th>contact</th>
                <th>email</th>
                <th>emp_age</th>
                <th>image</th>
                <th>Action</th>
            </tr>

        </thead>
       
    </table>

<script>
    $(document).ready(function () {
        debugger;
        $.ajax({
            type: "GET",
            url: "/Employee/EmployeeList",
            // data: 'first_name=' + firstname + '&last_name=' + lastname + '&contact=' + contactno + '&email=' + emailid + '&age=' + age + '&image=' + image,
            success: function (data) {
                $('#myTable').DataTable({
                    data: data,
                    columns: [
                        { data: 'id' },
                        { data: 'firstName' },
                        { data: 'lastName' },
                        { data: 'contactNo' },
                        { data: 'emailId' },
                        { data: 'age' },
                        {
                            data: 'imagePath',
                            mRender: function (data, type, row) {
                                return '<img src="/images/' + data + '"width="20px height=20px" />';
                            }
                        },
                        {
                            data: null,
                            mRender: function (data, type, row) {
                                return ` <button type="button" onclick="popupdateData(` + row.id + `)" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#updateModal">edit</button>|<button type="button" onclick="viewData(` + row.id + `)" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#viewModal">View</button>|<button type="button" onclick="DeleteEmployee(` + row.id + `)" class="btn btn-primary" >Delete</button>`;
           
                            }
                        }
                    ]
                });
                // Success = true;//doesn't go here
            },
            error: function (textStatus, errorThrown) {
                Success = false; //doesn't go here
            }

        });

    });

    
    function AddEmployee()
    {
        var oModel = {
            firstName: $('#firstName').val(),
            lastName: $('#lastName').val(),
            contactNo: $('#contactNumber').val(),
            emailId: $('#emailId').val(),
            age: $('#age').val(),
            image : $('#imagefile').val(),
        }
        debugger;
         $.ajax({
            url: "/Employee/Create",
            type: "POST",
            data:JSON.stringify( oModel),
            contentType: "application/json",
            success: function (data, textStatus, jqXHR) {
                alert('Success!');
                $('#exampleModal').modal('hide');
                location.reload();
            },
            error: function (jqXHR, textStatus, errorThrown) {
                alert('Error occurred!');
                location.reload();
            },

        });
    }

   

  function DeleteEmployee(id)
  {
         var ans = confirm("Are you sure you want to delete this Record?");
         if (ans) {

             $.ajax({
                 url: "/Employee/Delete?id=" + id,
                 type: "POST",
                 contentType: "application/json",
                 dataType: "json",
                 success: function (result) {
                    alert('Success!');
                    $('#exampleModal').modal('hide');
                    location.reload();
                 },
                 error: function (errormessage) {
                     alert(errormessage.responseText);
                 }
             });
      }
  }
    // var employeeIdToUpdate;
    function popupdateData(id) 
    {
      
        debugger;
        // employeeIdToUpdate = id;

        $.ajax({
            type: "GET",
            url: "/Employee/Update?id=" + id,
           success: function (data) {
              debugger;
                $('#updatedFirstName').val(data.firstName);
                $('#updatedlastName').val(data.lastName);
                $('#updatedcontactNumber').val(data.contactNo);
                $('#updatedemailId').val(data.emailId);
                $('#updatedage').val(data.age);
               $("#updateemp_id").val(id);
          },
        });
    }
    
    var id;
    function updateEmployee() {
        debugger;
        var updatedModel = {
            // id: employeeidtoupdate,
            firstName: $('#updatedFirstName').val(),
            lastName: $('#updatedlastName').val(),
            contactNo: $('#updatedcontactNumber').val(),
            emailId: $('#updatedemailId').val(),
            age: $('#updatedage').val(),
            // image: $('#updatedImageFile').val(),
        };
        debugger;
        $.ajax({
            url: "/Employee/Update1?id=" + $("#updateemp_id").val(),
            type: "POST", 
            data: JSON.stringify(updatedModel),
            contentType: "application/json",
            success: function (data, textStatus, jqXHR) {
                alert('Update successful!');
                $('#updateModal').modal('hide');
                location.reload();
               
            },
            error: function (jqXHR, textStatus, errorThrown) {
                console.error("Update error:", errorThrown);
                alert('Error occurred during update!');
                location.reload();
            },
        });
    }

    function viewData(id) {
        debugger;
        $.ajax({
            type: "POST",
            url: "/Employee/Update?id=" + id,
            success: function (data) {
                debugger;
                $("#viewemp_id").val(data.id);
                $('#viewFirstName').val(data.firstName);
                $('#viewlastName').val(data.lastName);
                $('#viewcontactNumber').val(data.contactNo);
                $('#viewemailId').val(data.emailId);
                $('#viewage').val(data.age);
            },
        });

    }
</script>
    


